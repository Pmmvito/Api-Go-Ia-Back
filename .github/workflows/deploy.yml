name: Deploy API Go no Servidor Ubuntu

on:
  push:
    branches:
      - main  # Ou a branch que vocÃª usa

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: ðŸšš Conectar via SSH e fazer Deploy
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.SERVER_HOST }}
          username: ${{ secrets.SERVER_USER }}
          key: ${{ secrets.SSH_PRIVATE_KEY }}

          script: |
            # 1. Navegue atÃ© a pasta do projeto
            cd /DATA/Downloads/Api-Go-Ia-Back

            # 2. Puxe as Ãºltimas alteraÃ§Ãµes
            git pull origin main

            # 3. Baixe dependÃªncias
            go mod tidy

            # 4. Atualize o Swagger
            echo "Atualizando o Swagger..."
            swag init

            # 5. Compile o novo binÃ¡rio
            echo "Compilando a aplicaÃ§Ã£o Go..."
            go build -o api-go-ia main.go

            # 6. Reinicie o serviÃ§o systemd
            echo "Reiniciando o serviÃ§o..."
            sudo systemctl restart api-go-ia.service

            echo "ðŸš€ Deploy finalizado!"
